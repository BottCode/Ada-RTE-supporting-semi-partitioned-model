<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Scenario 3</title>
        <style>
</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        
        <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </head>
    <body class="vscode-light">
        <h1 id="scenario-3">Scenario 3</h1>
<p>Questo scenario, costruito a partire dallo <a href="../scenario_2/scenario_2.html">scenario 2</a>, si occupa di:</p>
<ul>
<li>aggiungere una casistica nella quale si deve disarmare l'evento temporale associato al task che sta perdendo/cedendo il core.</li>
<li>formulare una prima (ma non completa) serie di azioni da effettuare in caso di rilevazione di un overrun.</li>
</ul>
<h2 id="disarmo-evento">Disarmo evento</h2>
<p>Un task <code>P1</code> in esecuzione può:</p>
<ol>
<li>cedere il core sul quale è in esecuzione in quanto sta eseguendo l'istruzione <code>delay_until X</code> dove <code>X</code> è un istante temporale <strong>assoluto</strong> strettamente maggiore di quello corrente;</li>
<li>perdere il core subendo preemption da un task <code>P2</code> a priorità strettamente più alta, ovvero il task <code>P1</code> in esecuzione non è più in testa alla coda di pronti di quel core.</li>
</ol>
<p>Il punto <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> è oggetto dello <a href="../scenario_2/scenario_2.html">scenario 2</a>.
Di seguito, si tratterà il punto <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>.</p>
<ul class="contains-task-list">
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> istanziare un task <code>P2</code> (oltre a <code>P1</code>) tale che <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>r</mi><mi>i</mi><mi>o</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo stretchy="false">(</mo><mi>P</mi><mn>2</mn><mo stretchy="false">)</mo><mo>&gt;</mo><mi>P</mi><mi>r</mi><mi>i</mi><mi>o</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo stretchy="false">(</mo><mi>P</mi><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Priority(P2) &gt; Priority(P1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></li>
</ul>
<pre><code><code><div>  P1 : Periodic_First_CPU (Pri =&gt; 10, Budget =&gt; 200_000, Period =&gt; 400_000);
  P2 : Periodic_First_CPU (Pri =&gt; 11, Budget =&gt; 0, Period =&gt; 1_200_000);
</div></code></code></pre>
<ul class="contains-task-list">
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> il corpo di <code>P1</code> non dovrà mai causare effettivamente un overrun, quindi il suo tempo di esecuzione deve essere al di sotto di <code>200_000</code> microsecondi.</li>
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> almeno un rilascio di <code>P2</code> deve avvenire nel mentre che <code>P1</code> sta eseguendo. In seguito:
<ul class="contains-task-list">
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> l'evento temporale legato all'eventuale overrun di <code>P1</code> deve essere <strong>disarmato</strong></li>
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> context switch da <code>P1</code> a <code>P2</code>;</li>
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> nessun evento temporale relativo a <code>P2</code> deve essere armato, in quanto il suo budget è <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>.</li>
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> al termine dell'esecuzione di <code>P2</code>, <code>P1</code> riprende l'esecuzione =&gt; context switch da <code>P2</code> a <code>P1</code>.</li>
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> al termine del context switch, un nuovo evento temporale, relativo all'eventuale overrun di <code>P1</code>, deve essere armato con scadenza all'istante temporale assoluto <code>Now + Budget</code>.</li>
</ul>
</li>
</ul>
<h2 id="una-preliminare-serie-di-azioni-in-risposta-ad-un-overrun">Una preliminare serie di azioni in risposta ad un overrun</h2>
<p>In questo sotto-scenario, i task <code>P1</code> e <code>P2</code> <strong>non</strong> devono essere istanziati.</p>
<ul class="contains-task-list">
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> creare un nuovo <em>type task</em> le quali istanze saranno relative a task che, prima o poi, forzeranno un overrun.</li>
</ul>
<pre><code><code><div>  task type Overruning_First_CPU
    (Pri     : System.Priority;
    Budget   : Ada.Real_Time.Microseconds;
    Workload : Positive;
    Period   : Positive) with CPU =&gt; 1
  is
    pragma Priority (Pri);
  end Overruning_First_CPU;
</div></code></code></pre>
<ul class="contains-task-list">
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> il corpo sarà:</li>
</ul>
<pre><code><code><div>task body Overruning_First_CPU is
    Next_Period : Ada.Real_Time.Time;
    I : Natural := 1;
begin
    Next_Period := Ada.Real_Time.Clock + Period;
    loop
      delay until Next_Period;

      if I mod 3 = 0 then
        Production_Workload.Small_Whetstone (Workload);
      end if;

      I := I + 1;

      Next_Period := Next_Period + Period;
    end loop;
end Overruning_First_CPU;
</div></code></code></pre>
<ul class="contains-task-list">
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> istanziare un task <code>Ov1</code> di tipo <code>Overruning_First_CPU</code>. Il valore del parametro <code>Workload</code> deve essere modulato in maniera tale da eccedere il budget allocato per <code>Ov1</code>.</li>
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> l'overrun di <code>0v1</code> deve essere forzato ogni 3 iterazioni.
<ul>
<li>non c'è un motivo sulla scelta di questo numero e, per ora, non è di interesse.</li>
</ul>
</li>
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> al verificarsi dell'overrun:
<ul class="contains-task-list">
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <code>Ov1</code> deve essere forzatamente rimosso dal core, ovvero essere rimosso dalla coda dei pronti di quel core</li>
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> essere inserito in una apposita coda che contiene i task che sono stati forzatamente rimossi da quello specifico core.
<ul>
<li>per ora, un task inserito in questa coda, non viene mai più re-inserito nella coda dei pronti.</li>
<li>la coda dei rimossi deve essere strutturalmente il più simile possibile a quella dei pronti e dei sospesi. In questo modo, sarà più probabile riuscire a riutilizzare le operazioni sulle code che sono già presenti nel runtime Ravenscar.</li>
</ul>
</li>
</ul>
</li>
</ul>

    </body>
    </html>